

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>VLAN Tutorial &mdash; Python  documentation</title>
  

  
  
  
  

  

  
  
    

  

  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Python
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction to Faucet</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="docker.html">Docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="recipe_book/index.html">Configuration Recipe Book</a></li>
<li class="toctree-l1"><a class="reference internal" href="vendors/index.html">Vendor-specific Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="external_resources.html">External Resources</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="developer_guide.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="fuzzing.html">Fuzzing</a></li>
<li class="toctree-l1"><a class="reference internal" href="source/index.html">Source Code</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="faq.html">Frequently Asked Questions</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Python</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>VLAN Tutorial</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/vlan_tutorial.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="vlan-tutorial">
<h1>VLAN Tutorial<a class="headerlink" href="#vlan-tutorial" title="Permalink to this headline">¶</a></h1>
<p>Next we are going to introduce VLANs.</p>
<p>ETA: ~30 mins.</p>
<div class="section" id="prerequisites">
<h2>Prerequisites:<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Faucet <a class="reference external" href="https://faucet.readthedocs.io/en/latest/tutorials.html#package-installation">Steps 1 &amp; 2</a></li>
<li>OpenVSwitch <a class="reference external" href="https://faucet.readthedocs.io/en/latest/tutorials.html#connect-your-first-datapath">Steps 1 &amp; 2</a></li>
<li>Useful Bash Functions (<a class="reference external" href="_static/tutorial/create_ns">create_ns</a>, <a class="reference external" href="_static/tutorial/as_ns">as_ns</a>, <a class="reference external" href="_static/tutorial/cleanup">cleanup</a>)</li>
</ul>
<p>In this tutorial we will look at how to do the following tasks using Faucet:</p>
<ul class="simple">
<li>Native VLAN.</li>
<li>Mixed VLANS (native and tagged).</li>
<li>Trunk links.</li>
<li>ACL for a particular VLAN.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You can find routing between VLANs <a class="reference external" href="./routing.html">here</a></p>
</div>
</div>
<div class="section" id="configuring-vlans">
<h2>Configuring VLANs:<a class="headerlink" href="#configuring-vlans" title="Permalink to this headline">¶</a></h2>
<p>To demonstrate these tasks we will use a demo network where a single switch br0 connects to:</p>
<ul class="simple">
<li>Native vlan100: host1 (192.168.0.1/24), host2 (192.168.0.2/24).</li>
<li>Tagged vlan100: host3 (veth0.100: 192.168.0.3/24), host4 (veth0.100: 192.168.0.4/24).</li>
<li>Native vlan200: host5 (192.168.2.5/24), host6 (192.168.2.6/24).</li>
<li>Tagged vlan300: host7 (veth0.300: 192.168.3.7/24), host8 (veth0.300: 192.168.3.8/24).</li>
<li>Tagged vlan100, vlan200, vlan300: host9 (veth0.100: 192.168.0.9/24,veth0.200: 192.168.2.9/24, veth0.300: 192.168.3.9/24).</li>
</ul>
<p>Here is the structure of the demo setup.</p>
<img alt="Demo network setup" class="align-center" src="_images/faucetVLANTutorial.png" />
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Keep a piece of paper with the network layout and hosts’ names, vlans, IPs to simplify following the rest of the tutorial.</p>
</div>
<p>In addition to the bash scripts in the prerequisite section we will use the following functions:</p>
<ul class="simple">
<li>to add a tagged network interface to a host namespaces</li>
<li>delete hosts</li>
</ul>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span>add_tagged_dev_ns () {
     NETNS=$1
     IP=$2
     VLAN=$3
     sudo ip netns exec $NETNS ip link add link veth0 name veth0.${VLAN} type vlan id $VLAN
     sudo ip netns exec $NETNS ip link set dev veth0.${VLAN} up
     sudo ip netns exec $NETNS ip addr flush dev veth0
     sudo ip netns exec $NETNS ip addr add dev veth0.${VLAN}  $IP
 }

clear_ns(){
   NETNS=$1
   sudo ip netns delete $NETNS
   sudo ovs-vsctl  del-port br0 veth-${NETNS}
}
</pre></div>
</div>
<div class="section" id="network-setup">
<h3>Network setup<a class="headerlink" href="#network-setup" title="Permalink to this headline">¶</a></h3>
<p>Let’s start. Keep host1, host2 on the native vlan 100 (office vlan) as in the first and second tutorials.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>To create the hosts and switch again run</p>
<div class="code console last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cleanup</span>
<span class="n">create_ns</span> <span class="n">host1</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">0.1</span><span class="o">/</span><span class="mi">24</span>
<span class="n">create_ns</span> <span class="n">host2</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">0.2</span><span class="o">/</span><span class="mi">24</span>
<span class="n">sudo</span> <span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">add</span><span class="o">-</span><span class="n">br</span> <span class="n">br0</span> \
<span class="o">--</span> <span class="nb">set</span> <span class="n">bridge</span> <span class="n">br0</span> <span class="n">other</span><span class="o">-</span><span class="n">config</span><span class="p">:</span><span class="n">datapath</span><span class="o">-</span><span class="nb">id</span><span class="o">=</span><span class="mi">0000000000000001</span> \
<span class="o">--</span> <span class="nb">set</span> <span class="n">bridge</span> <span class="n">br0</span> <span class="n">other</span><span class="o">-</span><span class="n">config</span><span class="p">:</span><span class="n">disable</span><span class="o">-</span><span class="ow">in</span><span class="o">-</span><span class="n">band</span><span class="o">=</span><span class="n">true</span> \
<span class="o">--</span> <span class="nb">set</span> <span class="n">bridge</span> <span class="n">br0</span> <span class="n">fail_mode</span><span class="o">=</span><span class="n">secure</span> \
<span class="o">--</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="n">br0</span> <span class="n">veth</span><span class="o">-</span><span class="n">host1</span> <span class="o">--</span> <span class="nb">set</span> <span class="n">interface</span> <span class="n">veth</span><span class="o">-</span><span class="n">host1</span> <span class="n">ofport_request</span><span class="o">=</span><span class="mi">1</span> \
<span class="o">--</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="n">br0</span> <span class="n">veth</span><span class="o">-</span><span class="n">host2</span> <span class="o">--</span> <span class="nb">set</span> <span class="n">interface</span> <span class="n">veth</span><span class="o">-</span><span class="n">host2</span> <span class="n">ofport_request</span><span class="o">=</span><span class="mi">2</span> \
<span class="o">--</span> <span class="nb">set</span><span class="o">-</span><span class="n">controller</span> <span class="n">br0</span> <span class="n">tcp</span><span class="p">:</span><span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">6653</span> <span class="n">tcp</span><span class="p">:</span><span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">6654</span>
</pre></div>
</div>
</div>
<p>Then add the following hosts with the corresponding vlan:</p>
<ul class="simple">
<li>In tagged vlan 100 add host3 and host4, and create a vlan interface on each of them.</li>
<li>In native vlan 200 add host5 and host6 (no need to add any vlan interface for hosts connected to native vlan).</li>
<li>In tagged vlan 300 add host7 and host8,  and create a vlan interface on each of them.</li>
<li>Add host9 to all previous vlans to work as NFV host .</li>
</ul>
<p>Let’s start.</p>
<p>Tagged vlan 100</p>
<div class="code console highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">create_ns</span>  <span class="n">host3</span> <span class="mi">0</span>
<span class="n">create_ns</span>  <span class="n">host4</span> <span class="mi">0</span>
<span class="n">add_tagged_dev_ns</span> <span class="n">host3</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">0.3</span><span class="o">/</span><span class="mi">24</span> <span class="mi">100</span>
<span class="n">add_tagged_dev_ns</span> <span class="n">host4</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">0.4</span><span class="o">/</span><span class="mi">24</span> <span class="mi">100</span>
</pre></div>
</div>
<p>Native vlan 200</p>
<div class="code console highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">create_ns</span>  <span class="n">host5</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">2.5</span><span class="o">/</span><span class="mi">24</span>
<span class="n">create_ns</span>  <span class="n">host6</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">2.6</span><span class="o">/</span><span class="mi">24</span>
</pre></div>
</div>
<p>Tagged vlan 300</p>
<div class="code console highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">create_ns</span>  <span class="n">host7</span> <span class="mi">0</span>
<span class="n">create_ns</span>  <span class="n">host8</span> <span class="mi">0</span>
<span class="n">add_tagged_dev_ns</span> <span class="n">host7</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">3.7</span><span class="o">/</span><span class="mi">24</span> <span class="mi">300</span>
<span class="n">add_tagged_dev_ns</span>  <span class="n">host8</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">3.8</span><span class="o">/</span><span class="mi">24</span> <span class="mi">300</span>
</pre></div>
</div>
<p>Trunk link for host9</p>
<div class="code console highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">create_ns</span>  <span class="n">host9</span> <span class="mi">0</span>
<span class="n">add_tagged_dev_ns</span> <span class="n">host9</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">0.9</span><span class="o">/</span><span class="mi">24</span> <span class="mi">100</span>
<span class="n">add_tagged_dev_ns</span> <span class="n">host9</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">2.9</span><span class="o">/</span><span class="mi">24</span> <span class="mi">200</span>
<span class="n">add_tagged_dev_ns</span> <span class="n">host9</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">3.9</span><span class="o">/</span><span class="mi">24</span> <span class="mi">300</span>
</pre></div>
</div>
<p>Then  connect all the hosts to the switch (br0)</p>
<div class="code console highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="n">br0</span> <span class="n">veth</span><span class="o">-</span><span class="n">host3</span> <span class="o">--</span> <span class="nb">set</span> <span class="n">interface</span> <span class="n">veth</span><span class="o">-</span><span class="n">host3</span> <span class="n">ofport_request</span><span class="o">=</span><span class="mi">3</span> \
<span class="o">--</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="n">br0</span> <span class="n">veth</span><span class="o">-</span><span class="n">host4</span> <span class="o">--</span> <span class="nb">set</span> <span class="n">interface</span> <span class="n">veth</span><span class="o">-</span><span class="n">host4</span> <span class="n">ofport_request</span><span class="o">=</span><span class="mi">4</span> \
<span class="o">--</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="n">br0</span> <span class="n">veth</span><span class="o">-</span><span class="n">host5</span> <span class="o">--</span> <span class="nb">set</span> <span class="n">interface</span> <span class="n">veth</span><span class="o">-</span><span class="n">host5</span> <span class="n">ofport_request</span><span class="o">=</span><span class="mi">5</span> \
<span class="o">--</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="n">br0</span> <span class="n">veth</span><span class="o">-</span><span class="n">host6</span> <span class="o">--</span> <span class="nb">set</span> <span class="n">interface</span> <span class="n">veth</span><span class="o">-</span><span class="n">host6</span> <span class="n">ofport_request</span><span class="o">=</span><span class="mi">6</span> \
<span class="o">--</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="n">br0</span> <span class="n">veth</span><span class="o">-</span><span class="n">host7</span> <span class="o">--</span> <span class="nb">set</span> <span class="n">interface</span> <span class="n">veth</span><span class="o">-</span><span class="n">host7</span> <span class="n">ofport_request</span><span class="o">=</span><span class="mi">7</span> \
<span class="o">--</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="n">br0</span> <span class="n">veth</span><span class="o">-</span><span class="n">host8</span> <span class="o">--</span> <span class="nb">set</span> <span class="n">interface</span> <span class="n">veth</span><span class="o">-</span><span class="n">host8</span> <span class="n">ofport_request</span><span class="o">=</span><span class="mi">8</span> \
<span class="o">--</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="n">br0</span> <span class="n">veth</span><span class="o">-</span><span class="n">host9</span> <span class="o">--</span> <span class="nb">set</span> <span class="n">interface</span> <span class="n">veth</span><span class="o">-</span><span class="n">host9</span> <span class="n">ofport_request</span><span class="o">=</span><span class="mi">9</span>
</pre></div>
</div>
<p>Now we have everything to start working with faucet through its configuration file.
Each time we need only to change the configuration file and restart faucet (or send it HUP signal to reload the configuration file).</p>
</div>
<div class="section" id="basic-vlan-settings">
<h3>Basic vlan settings<a class="headerlink" href="#basic-vlan-settings" title="Permalink to this headline">¶</a></h3>
<p>Change /etc/faucet/faucet.yaml to reflect our setting.</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">/etc/faucet/faucet.yaml</span><a class="headerlink" href="#id2" title="Permalink to this code">¶</a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">vlans</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">vlan100</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">vid</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">100</span>
    <span class="l l-Scalar l-Scalar-Plain">vlan200</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">vid</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">200</span>
    <span class="l l-Scalar l-Scalar-Plain">vlan300</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">vid</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">300</span>
<span class="l l-Scalar l-Scalar-Plain">dps</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">sw1</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">dp_id</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">0x1</span>
        <span class="l l-Scalar l-Scalar-Plain">hardware</span><span class="p p-Indicator">:</span> <span class="s">&quot;Open</span><span class="nv"> </span><span class="s">vSwitch&quot;</span>
        <span class="l l-Scalar l-Scalar-Plain">interfaces</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">1</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="s">&quot;host1&quot;</span>
                <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="s">&quot;host2</span><span class="nv"> </span><span class="s">network</span><span class="nv"> </span><span class="s">namespace&quot;</span>
                <span class="l l-Scalar l-Scalar-Plain">native_vlan</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">vlan100</span>
            <span class="l l-Scalar l-Scalar-Plain">2</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="s">&quot;host2&quot;</span>
                <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="s">&quot;host2</span><span class="nv"> </span><span class="s">network</span><span class="nv"> </span><span class="s">namespace&quot;</span>
                <span class="l l-Scalar l-Scalar-Plain">native_vlan</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">vlan100</span>
            <span class="l l-Scalar l-Scalar-Plain">3</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="s">&quot;host3&quot;</span>
                <span class="l l-Scalar l-Scalar-Plain">tagged_vlans</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="nv">vlan100</span><span class="p p-Indicator">]</span>
            <span class="l l-Scalar l-Scalar-Plain">4</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="s">&quot;host4&quot;</span>
                <span class="l l-Scalar l-Scalar-Plain">tagged_vlans</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="nv">vlan100</span><span class="p p-Indicator">]</span>
            <span class="l l-Scalar l-Scalar-Plain">5</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="s">&quot;host5&quot;</span>
                <span class="l l-Scalar l-Scalar-Plain">native_vlan</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">vlan200</span>
            <span class="l l-Scalar l-Scalar-Plain">6</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="s">&quot;host6&quot;</span>
                <span class="l l-Scalar l-Scalar-Plain">native_vlan</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">vlan200</span>
            <span class="l l-Scalar l-Scalar-Plain">7</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="s">&quot;host7&quot;</span>
                <span class="l l-Scalar l-Scalar-Plain">tagged_vlans</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="nv">vlan300</span><span class="p p-Indicator">]</span>
            <span class="l l-Scalar l-Scalar-Plain">8</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="s">&quot;host8&quot;</span>
                <span class="l l-Scalar l-Scalar-Plain">tagged_vlans</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="nv">vlan300</span><span class="p p-Indicator">]</span>
            <span class="l l-Scalar l-Scalar-Plain">9</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="s">&quot;host9&quot;</span>
                <span class="l l-Scalar l-Scalar-Plain">tagged_vlans</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="nv">vlan100</span><span class="p p-Indicator">,</span><span class="nv">vlan200</span><span class="p p-Indicator">,</span><span class="nv">vlan300</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
</div>
<p>Send SIGHUP signal to reload the configuration file, and check how its log the new configuration in /var/log/faucet/faucet.log</p>
<div class="code console highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">pkill</span> <span class="o">-</span><span class="n">HUP</span> <span class="o">-</span><span class="n">f</span> <span class="s2">&quot;faucet\.faucet&quot;</span>
<span class="n">cat</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">log</span><span class="o">/</span><span class="n">faucet</span><span class="o">/</span><span class="n">faucet</span><span class="o">.</span><span class="n">log</span>
</pre></div>
</div>
<p>Let’s do the following simple tests:</p>
<ol class="arabic simple">
<li>Ping between hosts in the same vlan</li>
</ol>
<div class="code console highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">as_ns</span> <span class="n">host1</span> <span class="n">ping</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">0.2</span>
<span class="n">as_ns</span> <span class="n">host3</span> <span class="n">ping</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">0.4</span>
<span class="n">as_ns</span> <span class="n">host5</span> <span class="n">ping</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">2.6</span>
<span class="n">as_ns</span> <span class="n">host7</span> <span class="n">ping</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">3.8</span>
</pre></div>
</div>
<p>All should work.</p>
<ol class="arabic simple" start="2">
<li>Ping between hosts in the same vlan where the port’s vlan mode is both native and tagged. In particular between host1 (native vlan100) to host3 (tagged vlan100).</li>
</ol>
<div class="code console highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">as_ns</span> <span class="n">host1</span> <span class="n">ping</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">0.3</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li>Ping between hosts in different vlans. Let’s change host5 (native vlan200) ip to be 192.168.0.5 and try to ping it from host1 (native vlan100).</li>
</ol>
<div class="code console highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">as_ns</span> <span class="n">host5</span> <span class="n">ifconfig</span> <span class="n">veth0</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">0.5</span>
<span class="n">as_ns</span> <span class="n">host1</span> <span class="n">ping</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">0.5</span>
</pre></div>
</div>
<p>It will not ping as they are in different vlans.
Let’s set host5’s IP back.</p>
<div class="code console highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">as_ns</span> <span class="n">host5</span> <span class="n">ifconfig</span> <span class="n">veth0</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">2.5</span>
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li>Test the trunk link to host9 from different vlans</li>
</ol>
<div class="code console highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">as_ns</span> <span class="n">host1</span> <span class="n">ping</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">0.9</span>
<span class="n">as_ns</span> <span class="n">host3</span> <span class="n">ping</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">0.9</span>
<span class="n">as_ns</span> <span class="n">host5</span> <span class="n">ping</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">2.9</span>
<span class="n">as_ns</span> <span class="n">host7</span> <span class="n">ping</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">3.9</span>
</pre></div>
</div>
<p>All of this traffic should go through to host9 as it is connected through the trunk link.</p>
</div>
<div class="section" id="vlan-acl">
<h3>Vlan ACL<a class="headerlink" href="#vlan-acl" title="Permalink to this headline">¶</a></h3>
<p>Let’s apply an ACL on a particular vlan (e.g. vlan300). We will block any ICMP packets on vlan300.
First create an ACL to block the ping.
Open /etc/faucet/faucet.yaml and add the ‘acls’ section.</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">/etc/faucet/faucet.yaml</span><a class="headerlink" href="#id3" title="Permalink to this code">¶</a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">acls</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">block-ping</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">rule</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">dl_type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">0x800</span>      <span class="c1"># IPv4</span>
            <span class="l l-Scalar l-Scalar-Plain">ip_proto</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>         <span class="c1"># ICMP</span>
            <span class="l l-Scalar l-Scalar-Plain">actions</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">allow</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">False</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">rule</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">dl_type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">0x86dd</span>     <span class="c1"># IPv6</span>
            <span class="l l-Scalar l-Scalar-Plain">ip_proto</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">58</span>        <span class="c1"># ICMPv6</span>
            <span class="l l-Scalar l-Scalar-Plain">actions</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">allow</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">False</span>
</pre></div>
</div>
</div>
<p>Then apply this on the vlan300.</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">/etc/faucet/faucet.yaml</span><a class="headerlink" href="#id4" title="Permalink to this code">¶</a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">vlans</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">vlan100</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">vid</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">100</span>
        <span class="l l-Scalar l-Scalar-Plain">faucet_vips</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;192.168.0.254/24&quot;</span><span class="p p-Indicator">]</span>
    <span class="l l-Scalar l-Scalar-Plain">vlan200</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">vid</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">200</span>
        <span class="l l-Scalar l-Scalar-Plain">faucet_vips</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;192.168.2.254/24&quot;</span><span class="p p-Indicator">]</span>
    <span class="l l-Scalar l-Scalar-Plain">vlan300</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">vid</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">300</span>
        <span class="l l-Scalar l-Scalar-Plain">acls_in</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="nv">block-ping</span><span class="p p-Indicator">]</span> <span class="c1"># Acl apply only on vlan300</span>
</pre></div>
</div>
</div>
<p>Just before we reload the configuration file. Let’s verify that pinging is working between hosts in vlan300.</p>
<div class="code console highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">as_ns</span> <span class="n">host7</span> <span class="n">ping</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">3.8</span>
</pre></div>
</div>
<p>Now let’s apply the configuration, send SIGHUP signal to reload the configuration file.</p>
<div class="code console highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">pkill</span> <span class="o">-</span><span class="n">HUP</span> <span class="o">-</span><span class="n">f</span> <span class="n">faucet</span><span class="o">.</span><span class="n">faucet</span>
</pre></div>
</div>
<p>Now if you try to ping from host7 and host8, it will not work as it is specified by their vlan acl.</p>
<div class="code console highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">as_ns</span> <span class="n">host7</span> <span class="n">ping</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">3.8</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Faucet Developers.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>