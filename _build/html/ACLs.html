

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>ACLs tutorial &mdash; Python  documentation</title>
  

  
  
  
  

  

  
  
    

  

  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Python
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction to Faucet</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="docker.html">Docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="recipe_book/index.html">Configuration Recipe Book</a></li>
<li class="toctree-l1"><a class="reference internal" href="vendors/index.html">Vendor-specific Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="external_resources.html">External Resources</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="developer_guide.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="fuzzing.html">Fuzzing</a></li>
<li class="toctree-l1"><a class="reference internal" href="source/index.html">Source Code</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="faq.html">Frequently Asked Questions</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Python</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>ACLs tutorial</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/ACLs.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="acls-tutorial">
<h1>ACLs tutorial<a class="headerlink" href="#acls-tutorial" title="Permalink to this headline">¶</a></h1>
<p>In the <a class="reference external" href="tutorials.html">first tutorial</a> we covered how to install and set-up Faucet.
Next we are going to introduce Access Control Lists (ACLs).</p>
<p>ETA: ~25 minutes.</p>
<div class="section" id="prerequisites">
<h2>Prerequisites:<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Faucet <a class="reference external" href="https://faucet.readthedocs.io/en/latest/tutorials.html#package-installation">Steps 1 &amp; 2</a></li>
<li>OpenVSwitch <a class="reference external" href="https://faucet.readthedocs.io/en/latest/tutorials.html#connect-your-first-datapath">Steps 1 &amp; 2</a></li>
<li>Useful Bash Functions (<a class="reference external" href="_static/tutorial/create_ns">create_ns</a>, <a class="reference external" href="_static/tutorial/as_ns">as_ns</a>, <a class="reference external" href="_static/tutorial/cleanup">cleanup</a>)</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">tcpdump is used to capture packets, sometimes it may be nescessary to exit tcpdump (ctrl + c) before packet output is shown.</p>
</div>
<p>unless stated tcpdump will be used with ping and it should only be necessary to run both for ~10 seconds.</p>
<p>First we will add two new hosts to our network:</p>
<div class="code console highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">create_ns</span> <span class="n">host3</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">0.3</span><span class="o">/</span><span class="mi">24</span>
<span class="n">create_ns</span> <span class="n">host4</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">0.4</span><span class="o">/</span><span class="mi">24</span>
</pre></div>
</div>
<p>And connect them to br0</p>
<div class="code console highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="n">br0</span> <span class="n">veth</span><span class="o">-</span><span class="n">host3</span> <span class="o">--</span> <span class="nb">set</span> <span class="n">interface</span> <span class="n">veth</span><span class="o">-</span><span class="n">host3</span> <span class="n">ofport_request</span><span class="o">=</span><span class="mi">3</span> \
<span class="o">--</span> <span class="n">add</span><span class="o">-</span><span class="n">port</span> <span class="n">br0</span> <span class="n">veth</span><span class="o">-</span><span class="n">host4</span> <span class="o">--</span> <span class="nb">set</span> <span class="n">interface</span> <span class="n">veth</span><span class="o">-</span><span class="n">host4</span> <span class="n">ofport_request</span><span class="o">=</span><span class="mi">4</span>
</pre></div>
</div>
<p>The configuration below will block ICMP on traffic coming in on port 3, and allow everything else.
Add this to /etc/faucet/faucet.yaml below the ‘dps’.</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">/etc/faucet/faucet.yaml</span><a class="headerlink" href="#id2" title="Permalink to this code">¶</a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span>            <span class="l l-Scalar l-Scalar-Plain">3</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="s">&quot;host3&quot;</span>
                <span class="l l-Scalar l-Scalar-Plain">native_vlan</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">office</span>
                <span class="l l-Scalar l-Scalar-Plain">acls_in</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="nv">block-ping</span><span class="p p-Indicator">,</span> <span class="nv">allow-all</span><span class="p p-Indicator">]</span>
            <span class="l l-Scalar l-Scalar-Plain">4</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="s">&quot;host4&quot;</span>
                <span class="l l-Scalar l-Scalar-Plain">native_vlan</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">office</span>
<span class="l l-Scalar l-Scalar-Plain">acls</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">block-ping</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">rule</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">dl_type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">0x800</span>      <span class="c1"># IPv4</span>
            <span class="l l-Scalar l-Scalar-Plain">ip_proto</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>         <span class="c1"># ICMP</span>
            <span class="l l-Scalar l-Scalar-Plain">actions</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">allow</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">False</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">rule</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">dl_type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">0x86dd</span>     <span class="c1"># IPv6</span>
            <span class="l l-Scalar l-Scalar-Plain">ip_proto</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">58</span>        <span class="c1"># ICMPv6</span>
            <span class="l l-Scalar l-Scalar-Plain">actions</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">allow</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">False</span>
    <span class="l l-Scalar l-Scalar-Plain">allow-all</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">rule</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">actions</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">allow</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
</pre></div>
</div>
</div>
<p>Faucet ACLs are made up of lists of rules.
The order of the rules in the list denote the priority with the first rules being highest and last lowest.
Each of these lists has a name (e.g. ‘block-ping’), and can be used on multiple port or VLAN ‘acls_in’ fields.
Again these are applied in order so all of ‘block-ping’ rules will be higher than ‘allow-all’.</p>
<p>Each rule contains two main items ‘matches’ and ‘actions’.
Matches are any packet field such as MAC/IP/transport source/destination fields.
For a full list visit <a class="reference external" href="https://ryu.readthedocs.io/en/latest/ofproto_v1_3_ref.html#flow-match-structure">https://ryu.readthedocs.io/en/latest/ofproto_v1_3_ref.html#flow-match-structure</a>
Actions are used to control what the packet does, for example normal l2 forwarding (‘allow’).
Apply a ‘meter’ to rate limit traffic, and manipulation of the packet contents and output.
Full list <a class="reference external" href="https://faucet.readthedocs.io/en/latest/configuration.html#id13">https://faucet.readthedocs.io/en/latest/configuration.html#id13</a></p>
<p>The above example has defined two ACLs ‘block-ping’ &amp; ‘allow-all’ these can be used on any and multiple ports or VLANs (more on VLANs later) using the ‘acls_in’ key.
The block-ping ACL has two rules, one to block ICMP on IPv4 and another for ICMPv6 on IPv6.
The allow-all ACL has one rule, which specifies no match fields, and therefore matches all packets, and the action ‘allow’.
The ‘allow’ action is a boolean, if it’s True allow the packet to continue through the Faucet pipeline, if False drop the packet.
‘allow’ can be used in conjunction with the other actions to let the traffic flow with the expected layer 2 forwarding behaviour AND be mirrored to another port.</p>
<p>Now tell Faucet to reload its configuration, this can be done by restarting the application.
But a better way is to send Faucet a SIGHUP signal.</p>
<div class="code console highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">check_faucet_config</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">faucet</span><span class="o">/</span><span class="n">faucet</span><span class="o">.</span><span class="n">yaml</span>
</pre></div>
</div>
<div class="code console highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pkill</span> <span class="o">-</span><span class="n">HUP</span> <span class="o">-</span><span class="n">f</span> <span class="n">faucet</span><span class="o">.</span><span class="n">faucet</span>
</pre></div>
</div>
<p>Now pings to/from host3 should fail, but the other three hosts should be fine.</p>
<p>Test this with</p>
<div class="code console highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">as_ns</span> <span class="n">host1</span> <span class="n">ping</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">0.3</span>
<span class="n">as_ns</span> <span class="n">host1</span> <span class="n">ping</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">0.4</span>
</pre></div>
</div>
<p>Mirror:
Mirroring traffic is useful if we want to send it to an out of band NFV service (e.g. Intrusion Detection System, packet capture the traffic).
To do this Faucet provides two ACL actions: mirror &amp; output.</p>
<p>The mirror action copies the packet, before any modifications, to the specified port (NOTE: mirroring is done in input direction only).</p>
<p>Let’s add the mirror action to our block-ping ACL /etc/faucet/faucet.yaml</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">/etc/faucet/faucet.yaml</span><a class="headerlink" href="#id3" title="Permalink to this code">¶</a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">...</span>
<span class="l l-Scalar l-Scalar-Plain">block-ping</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">rule</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">dl_type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">0x800</span>
        <span class="l l-Scalar l-Scalar-Plain">ip_proto</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
        <span class="l l-Scalar l-Scalar-Plain">actions</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">allow</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">False</span>
            <span class="l l-Scalar l-Scalar-Plain">mirror</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">4</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">rule</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">dl_type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">0x86dd</span>
        <span class="l l-Scalar l-Scalar-Plain">ip_proto</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">58</span>
        <span class="l l-Scalar l-Scalar-Plain">actions</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">allow</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">False</span>
            <span class="l l-Scalar l-Scalar-Plain">mirror</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">4</span>
</pre></div>
</div>
</div>
<p>And again send the sighup signal to Faucet</p>
<div class="code console highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pkill</span> <span class="o">-</span><span class="n">HUP</span> <span class="o">-</span><span class="n">f</span> <span class="n">faucet</span><span class="o">.</span><span class="n">faucet</span>
</pre></div>
</div>
<p>To check this we will ping from host1 to host3, while performing a tcpdump on host4 who should receive the ping replies.
It is a good idea to run each from a different terminal (screen, tmux, …)</p>
<div class="code console highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">as_ns</span> <span class="n">host1</span> <span class="n">ping</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">0.3</span>
</pre></div>
</div>
<p>Ping should have 100% packet loss.</p>
<div class="code console highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">as_ns</span> <span class="n">host4</span> <span class="n">tcpdump</span> <span class="o">-</span><span class="n">e</span> <span class="o">-</span><span class="n">n</span> <span class="o">-</span><span class="n">i</span> <span class="n">veth0</span>
</pre></div>
</div>
<div class="code console highlight-default notranslate"><div class="highlight"><pre><span></span>$ as_ns host4 tcpdump -e -n -i veth0
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on veth0, link-type EN10MB (Ethernet), capture size 262144 bytes
13:24:36.848331 2e:d4:1a:ca:54:4b &gt; 06:5f:14:fc:47:02, ethertype IPv4 (0x0800), length 98: 192.168.0.3 &gt; 192.168.0.1: ICMP echo reply, id 23660, seq 16, length 64
13:24:37.857024 2e:d4:1a:ca:54:4b &gt; 06:5f:14:fc:47:02, ethertype IPv4 (0x0800), length 98: 192.168.0.3 &gt; 192.168.0.1:   ICMP echo reply, id 23660, seq 17, length 64
13:24:38.865005 2e:d4:1a:ca:54:4b &gt; 06:5f:14:fc:47:02, ethertype IPv4 (0x0800), length 98: 192.168.0.3 &gt; 192.168.0.1: ICMP echo reply, id 23660, seq 18, length 64
13:24:39.873377 2e:d4:1a:ca:54:4b &gt; 06:5f:14:fc:47:02, ethertype IPv4 (0x0800), length 98: 192.168.0.3 &gt; 192.168.0.1: ICMP echo reply, id 23660, seq 19, length 64
13:24:40.881129 2e:d4:1a:ca:54:4b &gt; 06:5f:14:fc:47:02, ethertype IPv4 (0x0800), length 98: 192.168.0.3 &gt; 192.168.0.1: ICMP echo reply, id 23660, seq 20, length 64
</pre></div>
</div>
<p>There is also the ‘output’ action which can be used to achieve the same thing.</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">/etc/faucet/faucet.yaml</span><a class="headerlink" href="#id4" title="Permalink to this code">¶</a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">block-ping</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">rule</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">dl_type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">0x800</span>
        <span class="l l-Scalar l-Scalar-Plain">ip_proto</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
        <span class="l l-Scalar l-Scalar-Plain">actions</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">allow</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">False</span>
            <span class="l l-Scalar l-Scalar-Plain">output</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">port</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">4</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">rule</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">dl_type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">0x86dd</span>
        <span class="l l-Scalar l-Scalar-Plain">ip_proto</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">58</span>
        <span class="l l-Scalar l-Scalar-Plain">actions</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">allow</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">False</span>
            <span class="l l-Scalar l-Scalar-Plain">output</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">port</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">4</span>
</pre></div>
</div>
</div>
<p>The output action also allows us to change the packet by setting fields (mac/ip addresses, …), VLAN operations (push/pop/swap VIDs).
It can be used in conjunction with the other actions, e.g. output directly and but do not allow through the Faucet pipeline (allow: false).</p>
<p>Let’s create a new ACL for host2’s port that will change the MAC source address.</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">/etc/faucet/faucet.yaml</span><a class="headerlink" href="#id5" title="Permalink to this code">¶</a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">dps</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">sw1</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">...</span>
        <span class="l l-Scalar l-Scalar-Plain">2</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="s">&quot;host2&quot;</span>
            <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="s">&quot;host2</span><span class="nv"> </span><span class="s">network</span><span class="nv"> </span><span class="s">namespace&quot;</span>
            <span class="l l-Scalar l-Scalar-Plain">native_vlan</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">office</span>
            <span class="l l-Scalar l-Scalar-Plain">acls_in</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="nv">rewrite-mac</span><span class="p p-Indicator">,</span> <span class="nv">allow-all</span><span class="p p-Indicator">]</span>
        <span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="l l-Scalar l-Scalar-Plain">acls</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">rewrite-mac</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">rule</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">actions</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">allow</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
                <span class="l l-Scalar l-Scalar-Plain">output</span><span class="p p-Indicator">:</span>
                    <span class="l l-Scalar l-Scalar-Plain">set_fields</span><span class="p p-Indicator">:</span>
                        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">eth_src</span><span class="p p-Indicator">:</span> <span class="s">&quot;00:00:00:00:00:02&quot;</span>
<span class="nn">...</span>
</pre></div>
</div>
</div>
<p>Again reload Faucet.</p>
<p>Start tcpdump on host1</p>
<div class="code console highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">as_ns</span> <span class="n">host1</span> <span class="n">tcpdump</span> <span class="o">-</span><span class="n">e</span> <span class="o">-</span><span class="n">n</span> <span class="o">-</span><span class="n">i</span> <span class="n">veth0</span>
</pre></div>
</div>
<p>Ping host1 from host2</p>
<div class="code console highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">as_ns</span> <span class="n">host2</span> <span class="n">ping</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">0.1</span>
</pre></div>
</div>
<p>Here we can see ICMP echo requests are coming from the MAC address “00:00:00:00:00:02” that we set in our output ACL.
(The reply is destined to the actual MAC address of host2 thanks to ARP) [TODO i think].</p>
<div class="code console highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tcpdump</span><span class="p">:</span> <span class="n">verbose</span> <span class="n">output</span> <span class="n">suppressed</span><span class="p">,</span> <span class="n">use</span> <span class="o">-</span><span class="n">v</span> <span class="ow">or</span> <span class="o">-</span><span class="n">vv</span> <span class="k">for</span> <span class="n">full</span> <span class="n">protocol</span> <span class="n">decode</span>
<span class="n">listening</span> <span class="n">on</span> <span class="n">veth0</span><span class="p">,</span> <span class="n">link</span><span class="o">-</span><span class="nb">type</span> <span class="n">EN10MB</span> <span class="p">(</span><span class="n">Ethernet</span><span class="p">),</span> <span class="n">capture</span> <span class="n">size</span> <span class="mi">262144</span> <span class="nb">bytes</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">53</span><span class="p">:</span><span class="mf">41.248235</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">02</span> <span class="o">&gt;</span> <span class="mi">06</span><span class="p">:</span><span class="mi">5</span><span class="n">f</span><span class="p">:</span><span class="mi">14</span><span class="p">:</span><span class="n">fc</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mi">02</span><span class="p">,</span> <span class="n">ethertype</span> <span class="n">IPv4</span> <span class="p">(</span><span class="mh">0x0800</span><span class="p">),</span> <span class="n">length</span> <span class="mi">98</span><span class="p">:</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">0.2</span> <span class="o">&gt;</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">0.1</span><span class="p">:</span> <span class="n">ICMP</span> <span class="n">echo</span> <span class="n">request</span><span class="p">,</span> <span class="nb">id</span> <span class="mi">23711</span><span class="p">,</span> <span class="n">seq</span> <span class="mi">1</span><span class="p">,</span> <span class="n">length</span> <span class="mi">64</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">53</span><span class="p">:</span><span class="mf">41.248283</span> <span class="mi">06</span><span class="p">:</span><span class="mi">5</span><span class="n">f</span><span class="p">:</span><span class="mi">14</span><span class="p">:</span><span class="n">fc</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mi">02</span> <span class="o">&gt;</span> <span class="n">ce</span><span class="p">:</span><span class="n">bb</span><span class="p">:</span><span class="mi">23</span><span class="p">:</span><span class="n">ce</span><span class="p">:</span><span class="n">d5</span><span class="p">:</span><span class="n">a0</span><span class="p">,</span> <span class="n">ethertype</span> <span class="n">IPv4</span> <span class="p">(</span><span class="mh">0x0800</span><span class="p">),</span> <span class="n">length</span> <span class="mi">98</span><span class="p">:</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">0.1</span> <span class="o">&gt;</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">0.2</span><span class="p">:</span> <span class="n">ICMP</span> <span class="n">echo</span> <span class="n">reply</span><span class="p">,</span> <span class="nb">id</span> <span class="mi">23711</span><span class="p">,</span> <span class="n">seq</span> <span class="mi">1</span><span class="p">,</span> <span class="n">length</span> <span class="mi">64</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">53</span><span class="p">:</span><span class="mf">42.247106</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">02</span> <span class="o">&gt;</span> <span class="mi">06</span><span class="p">:</span><span class="mi">5</span><span class="n">f</span><span class="p">:</span><span class="mi">14</span><span class="p">:</span><span class="n">fc</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mi">02</span><span class="p">,</span> <span class="n">ethertype</span> <span class="n">IPv4</span> <span class="p">(</span><span class="mh">0x0800</span><span class="p">),</span> <span class="n">length</span> <span class="mi">98</span><span class="p">:</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">0.2</span> <span class="o">&gt;</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">0.1</span><span class="p">:</span> <span class="n">ICMP</span> <span class="n">echo</span> <span class="n">request</span><span class="p">,</span> <span class="nb">id</span> <span class="mi">23711</span><span class="p">,</span> <span class="n">seq</span> <span class="mi">2</span><span class="p">,</span> <span class="n">length</span> <span class="mi">64</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">53</span><span class="p">:</span><span class="mf">42.247154</span> <span class="mi">06</span><span class="p">:</span><span class="mi">5</span><span class="n">f</span><span class="p">:</span><span class="mi">14</span><span class="p">:</span><span class="n">fc</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mi">02</span> <span class="o">&gt;</span> <span class="n">ce</span><span class="p">:</span><span class="n">bb</span><span class="p">:</span><span class="mi">23</span><span class="p">:</span><span class="n">ce</span><span class="p">:</span><span class="n">d5</span><span class="p">:</span><span class="n">a0</span><span class="p">,</span> <span class="n">ethertype</span> <span class="n">IPv4</span> <span class="p">(</span><span class="mh">0x0800</span><span class="p">),</span> <span class="n">length</span> <span class="mi">98</span><span class="p">:</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">0.1</span> <span class="o">&gt;</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">0.2</span><span class="p">:</span> <span class="n">ICMP</span> <span class="n">echo</span> <span class="n">reply</span><span class="p">,</span> <span class="nb">id</span> <span class="mi">23711</span><span class="p">,</span> <span class="n">seq</span> <span class="mi">2</span><span class="p">,</span> <span class="n">length</span> <span class="mi">64</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">53</span><span class="p">:</span><span class="mf">43.249726</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">02</span> <span class="o">&gt;</span> <span class="mi">06</span><span class="p">:</span><span class="mi">5</span><span class="n">f</span><span class="p">:</span><span class="mi">14</span><span class="p">:</span><span class="n">fc</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mi">02</span><span class="p">,</span> <span class="n">ethertype</span> <span class="n">IPv4</span> <span class="p">(</span><span class="mh">0x0800</span><span class="p">),</span> <span class="n">length</span> <span class="mi">98</span><span class="p">:</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">0.2</span> <span class="o">&gt;</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">0.1</span><span class="p">:</span> <span class="n">ICMP</span> <span class="n">echo</span> <span class="n">request</span><span class="p">,</span> <span class="nb">id</span> <span class="mi">23711</span><span class="p">,</span> <span class="n">seq</span> <span class="mi">3</span><span class="p">,</span> <span class="n">length</span> <span class="mi">64</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">53</span><span class="p">:</span><span class="mf">43.249757</span> <span class="mi">06</span><span class="p">:</span><span class="mi">5</span><span class="n">f</span><span class="p">:</span><span class="mi">14</span><span class="p">:</span><span class="n">fc</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mi">02</span> <span class="o">&gt;</span> <span class="n">ce</span><span class="p">:</span><span class="n">bb</span><span class="p">:</span><span class="mi">23</span><span class="p">:</span><span class="n">ce</span><span class="p">:</span><span class="n">d5</span><span class="p">:</span><span class="n">a0</span><span class="p">,</span> <span class="n">ethertype</span> <span class="n">IPv4</span> <span class="p">(</span><span class="mh">0x0800</span><span class="p">),</span> <span class="n">length</span> <span class="mi">98</span><span class="p">:</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">0.1</span> <span class="o">&gt;</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">0.2</span><span class="p">:</span> <span class="n">ICMP</span> <span class="n">echo</span> <span class="n">reply</span><span class="p">,</span> <span class="nb">id</span> <span class="mi">23711</span><span class="p">,</span> <span class="n">seq</span> <span class="mi">3</span><span class="p">,</span> <span class="n">length</span> <span class="mi">64</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">53</span><span class="p">:</span><span class="mf">44.248713</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">02</span> <span class="o">&gt;</span> <span class="mi">06</span><span class="p">:</span><span class="mi">5</span><span class="n">f</span><span class="p">:</span><span class="mi">14</span><span class="p">:</span><span class="n">fc</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mi">02</span><span class="p">,</span> <span class="n">ethertype</span> <span class="n">IPv4</span> <span class="p">(</span><span class="mh">0x0800</span><span class="p">),</span> <span class="n">length</span> <span class="mi">98</span><span class="p">:</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">0.2</span> <span class="o">&gt;</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">0.1</span><span class="p">:</span> <span class="n">ICMP</span> <span class="n">echo</span> <span class="n">request</span><span class="p">,</span> <span class="nb">id</span> <span class="mi">23711</span><span class="p">,</span> <span class="n">seq</span> <span class="mi">4</span><span class="p">,</span> <span class="n">length</span> <span class="mi">64</span>
<span class="mi">13</span><span class="p">:</span><span class="mi">53</span><span class="p">:</span><span class="mf">44.248738</span> <span class="mi">06</span><span class="p">:</span><span class="mi">5</span><span class="n">f</span><span class="p">:</span><span class="mi">14</span><span class="p">:</span><span class="n">fc</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mi">02</span> <span class="o">&gt;</span> <span class="n">ce</span><span class="p">:</span><span class="n">bb</span><span class="p">:</span><span class="mi">23</span><span class="p">:</span><span class="n">ce</span><span class="p">:</span><span class="n">d5</span><span class="p">:</span><span class="n">a0</span><span class="p">,</span> <span class="n">ethertype</span> <span class="n">IPv4</span> <span class="p">(</span><span class="mh">0x0800</span><span class="p">),</span> <span class="n">length</span> <span class="mi">98</span><span class="p">:</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">0.1</span> <span class="o">&gt;</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">0.2</span><span class="p">:</span> <span class="n">ICMP</span> <span class="n">echo</span> <span class="n">reply</span><span class="p">,</span> <span class="nb">id</span> <span class="mi">23711</span><span class="p">,</span> <span class="n">seq</span> <span class="mi">4</span><span class="p">,</span> <span class="n">length</span> <span class="mi">64</span>
</pre></div>
</div>
<p>With the output action we could also use it to mirror traffic to a NFV server (like our fake mirror output action above), and use a VLAN tag to identify what port the traffic originated on on the switch.
To do this we will use both the ‘port’ &amp; ‘vlan_vid’ output fields.</p>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text">/etc/faucet/faucet.yaml</span><a class="headerlink" href="#id6" title="Permalink to this code">¶</a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">block-ping</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">rule</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">dl_type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">0x800</span>
        <span class="l l-Scalar l-Scalar-Plain">ip_proto</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
        <span class="l l-Scalar l-Scalar-Plain">actions</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">allow</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">False</span>
            <span class="l l-Scalar l-Scalar-Plain">output</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">vlan_vid</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
                <span class="l l-Scalar l-Scalar-Plain">port</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">4</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">rule</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">dl_type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">0x86dd</span>
        <span class="l l-Scalar l-Scalar-Plain">ip_proto</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">58</span>
        <span class="l l-Scalar l-Scalar-Plain">actions</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">allow</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">False</span>
            <span class="l l-Scalar l-Scalar-Plain">output</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">vlan_vid</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
                <span class="l l-Scalar l-Scalar-Plain">port</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">4</span>
</pre></div>
</div>
</div>
<p>Again reload Faucet, start a tcpdump on host4, and ping from host1 to host3.
Ping should still not be allowed through and the tcpdump output should be similar to below (Note the 802.1Q tag and vlan 3):</p>
<div class="code console highlight-default notranslate"><div class="highlight"><pre><span></span>$ as_ns host4 tcpdump -e -n -i veth0
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on veth0, link-type EN10MB (Ethernet), capture size 262144 bytes
14:14:15.285329 2e:d4:1a:ca:54:4b &gt; 06:5f:14:fc:47:02, ethertype 802.1Q (0x8100), length 102: vlan 3, p 0, ethertype IPv4, 192.168.0.3 &gt; 192.168.0.1: ICMP echo reply, id 23747, seq 1, length 64
14:14:16.293016 2e:d4:1a:ca:54:4b &gt; 06:5f:14:fc:47:02, ethertype 802.1Q (0x8100), length 102: vlan 3, p 0, ethertype IPv4, 192.168.0.3 &gt; 192.168.0.1: ICMP echo reply, id 23747, seq 2, length 64
14:14:17.300898 2e:d4:1a:ca:54:4b &gt; 06:5f:14:fc:47:02, ethertype 802.1Q (0x8100), length 102: vlan 3, p 0, ethertype IPv4, 192.168.0.3 &gt; 192.168.0.1: ICMP echo reply, id 23747, seq 3, length 64
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Faucet Developers.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>